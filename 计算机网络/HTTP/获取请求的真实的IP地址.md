> https://blog.thinkeridea.com/201903/go/get_client_ip.html

## X-Forwarded-For

在 HTTP 请求中获取请求的真实 IP 地址可以有几种方式，但最常见的是通过查看 HTTP 请求头中的 X-Forwarded-For 字段。

HTTP/1.1（RFC 2616）协议并没有对它的定义，它最开始是由 Squid 这个缓存代理软件引入。

如今它已经成为事实上的标准，被各大 HTTP 代理、负载均衡等转发服务广泛使用。只有在通过了 HTTP 代理或者负载均衡服务器时才会添加该项。

```
X-Forwarded-For: client, proxy1, proxy2
```

一般情况下，第一个ip为客户端真实ip，后面的为经过的代理服务器ip。

这些字段通常由代理服务器或者负载均衡器添加，以便将请求转发到后端服务器。在这些字段中，通常会包含客户端真实的 IP 地址。

## 如果头部被篡改该怎么办？

X-Forwarded-For 头部可能会被篡改或者伪造，因此不能百分之百信任其中的 IP 地址。

最安全的方式是在服务器端和网络架构中确保只有受信任的代理服务器可以添加或修改这些头部，并且进行适当的安全设置以保护您的应用程序免受 IP 地址伪造攻击。