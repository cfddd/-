## 单方面断开的问题
socket相关函数断开连接，意味着**双向完全断开**。
不仅无法传输数据，也不能接受数据。

![[Pasted image 20230804104148.png]]
图中描述的是 2 台主机正在进行双向通信，主机 A 发送完最后的数据后，调用 close 函数断开了最后的 连接，之后主机 A 无法再接受主机 B 传输的数据。实际上，是完全无法调用与接受数据相关的函数。 最终，由主机 B 传输的、主机 A 必须要接受的数据也销毁了。

为了解决这类问题,**“只关闭一部分数据交换中使用的流”** 的方法应运而生。
断开一部分连接是指，可以传输数据但无法接收，或可以接收数据但无法传输。顾名思义就是只关闭流的一半。
## 套接字和流
建立套接字后可以交换数据的状态看作一种流
双向通信需要两个流
socket相关函数断开连接，意味着同时断开两个流

## shutdown
![[Pasted image 20230804105031.png]]
第二个参数决定断开链接的方式
- SHUT_RD:断开输入流。
- SHUT_WR:断开输出流。
- SHUT RDWR:同时断开I/O流。
若向 shutdown 的第二个参数传递 SHUT_RD ，则断开输入流，套接字无法接收数据。即使输入缓冲收 到数据也回抹去，而且无法调用相关函数。如果向 shutdown 的第二个参数传递 SHUT_WR ，则中断输 出流，也就无法传输数据。若如果输出缓冲中还有未传输的数据，则将传递给目标主机。最后，若传递 关键字 SHUT_RDWR ，则同时中断 I/O 流。这相当于分 2 次调用 shutdown ，其中一次以 SHUT_RD 为参 数，另一次以 SHUT_WR 为参数。

### 半关闭和文件结尾符EOF
服务端应最 后向客户端传递 EOF 表示文件传输结束。客户端通过函数返回值接受 EOF ，这样可以避免与文件内容冲突。
调用 shutdown 函数，只关闭服务器的输出流。这样既可以发送 EOF ，同时又保留了输入流。下面 实现收发文件的服务器端/客户端。

![[file_client.c]]

![[file_server.c]]