> [面试必杀技，讲一讲Spring中的循环依赖 - 明智说 - 博客园 (cnblogs.com)](https://www.cnblogs.com/daimzh/p/13256413.html)
> 
> [一看就懂，图解 Spring 循环依赖，写得老好了！ - 知乎 (zhihu.com)](https://zhuanlan.zhihu.com/p/143536005)


## 什么是循环依赖
1. 两个对象之间相互依赖
2. 多个对象之间相互依赖
3. 单个对象依赖自己

最简单的单例 Bean 可以假想是有一个一级缓存，存放着所有的 Bean 单例，这显然没办法解决循环依赖问题
## 三级缓存
| 缓存级别     | 作用                                 |
| -------- | ---------------------------------- |
| **三级缓存** | 提前暴露的一个单例工厂，二级缓存中存储的就是从这个工厂中获取到的对象 |
| **二级缓存** | 完成实例化，但是还未进行属性注入及初始化的对象            |
| **一级缓存** | 创建好了的单例Bean                        |

| bean 创建过程     | 详细内容            |
| ------------- | --------------- |
| getSignleton  | 获取对象            |
| doCreateBean  | 创建对象            |
| populateBean  | 填充对象属性          |
| addSignaleton | 将对象添加到单例对象一级缓存中 |

1. A对象获取失败，开始创建对象
2. 创建A对象时提前暴露一个A工厂，开始填充A中属性
3. 发现A对象中需要B，于是去获取B
4. B获取单例失败，开始创建B
5. 创建B对象同样需要提前暴露一个B工厂，开始填充B中属性
6. 发现B对象中需要A，但是二级缓存中已经有了暴露A的工厂，于是用该工厂创建A，然后删除该工厂，并完成B的创建，添加到一级缓存中
7. A填充完毕，也添加到一级缓存中
