> [7分钟精通MySql中SQL执行原理_哔哩哔哩_bilibili](https://www.bilibili.com/video/BV1mg411s7Ej/?spm_id_from=333.337.search-card.all.click&vd_source=2d885cb62bb9393fa8a5379c72eabd82)
> 
> [一条Update语句的执行过程是怎样的？ - 知乎](https://zhuanlan.zhihu.com/p/639174065)
## 一条SQL的执行
### 1. 客户端发送请求
用户在客户端应用程序中编写 SQL 语句，然后通过数据库连接将该语句发送给数据库服务器。
### 2. 连接管理与验证
数据库服务器接收到客户端的连接请求后，首先会进行连接管理操作，包括验证客户端的身份信息，如用户名和密码，以确保客户端具有访问数据库的权限。如果验证通过，服务器会为该客户端建立一个连接会话，用于后续的交互。
### 3. 语法解析
解析器的任务是对 SQL 语句进行语法分析，检查语句是否符合数据库所遵循的 SQL 语法规则。

它会将 SQL 语句分解为一个个的语法单元，如关键字、标识符、操作符、常量等，并构建一棵语法树来表示语句的结构

例如，对于语句`SELECT * FROM users WHERE age > 25;`，解析器会识别出`SELECT`、`*`、`FROM`、`users`、`WHERE`、`age`、`>`、`25`等语法单元，并构建一棵反映该语句逻辑结构的语法树，其中`SELECT`是根节点，`*`是其下的一个子节点，表示要选择的列，`FROM`节点下连接着`users`表，`WHERE`节点则包含了筛选条件等。
### 4. 语义分析
语义分析器会检查 SQL 语句的语义是否正确，包括检查所引用的表、列、视图等数据库对象是否存在，以及用户是否具有对这些对象执行相应操作的权限等。
### 5. 查询优化

如果 SQL 语句是一个查询语句，数据库会对其进行查询优化。优化器会根据数据库的统计信息、索引情况以及查询的特点，生成一个最优的查询执行计划。

**优化器会考虑多种因素**：
- 选择合适的索引来提高查询效率
- 确定表的连接顺序
- 决定是否使用临时表
### 6.执行计划生成与执行
行引擎会按照执行计划的步骤，依次调用存储引擎的接口来访问和操作数据。

### 7. 存储引擎操作
存储引擎是数据库管理系统中负责数据存储和检索的组件。不同的数据库系统可能支持不同的存储引擎，如 MySQL 的 InnoDB、MyISAM 等。存储引擎会根据执行引擎的请求，实际执行数据的读取、写入、更新、删除等操作

### 8. 结果集返回
如果 SQL 语句是一个查询语句，在执行完成后，数据库会将查询结果集返回给客户端。结果集通常以表格的形式呈现，包含了查询所选择的列和满足条件的行的数据。

### 9. 资源释放与连接关闭
在 SQL 语句执行完毕后，数据库会释放与该执行过程相关的各种资源，如内存、锁等。

## 一条UPDATE语句的过程
基本流程和上面一样，下面添加一些UPDATE特有的部分
### 日志记录
在数据更新的同时，数据库会将更新操作记录到事务日志中。事务日志用于保证数据库的事务一致性和可恢复性。

如果在更新过程中出现系统故障或其他异常情况，数据库可以根据事务日志中的记录，回滚到更新操作之前的状态，或者在系统恢复后重新执行未完成的更新操作，以确保数据的完整性和一致性。
### 索引维护
如果更新操作涉及到了索引列，那么数据库还需要对相关的索引进行维护。

例如，当更新了一个索引列的值后，数据库需要更新索引中相应的键值，以确保索引的正确性和有效性。这可能涉及到在索引中删除旧的键值对，并插入新的键值对，或者对索引进行调整和重组，以保持索引的性能。
### 存储引擎操作
不同的数据库存储引擎在数据存储和操作方式上可能会有所不同。

例如，MySQL 的 InnoDB 存储引擎采用了事务日志和缓冲池等技术来提高性能和保证数据一致性。在执行`UPDATE`操作时，InnoDB 会先将更新的数据写入缓冲池，然后在合适的时候将缓冲池中的数据刷新到磁盘上的数据文件中。同时，InnoDB 会根据事务日志中的记录，确保数据的持久化和一致性。