## 倒排索引
**倒排索引(Inverted Index)** 也叫反向索引，有反向索引必有正向索引。
通俗地来讲，**正向索引**是通过key找valug，**反向索引**则是通过value找key。
ES底层在检索时底层使用的就是倒排索引。
## 索引模型
先有索引和映射如下：
```json
{
"products" : {
	"mappings" : {
		"properties" : {
			"description" : {
				"type" : "text"
			},
			"price" : {
				"type": "float"
			},
			"title": {
				"type" : "keyword"
			}
		}
	}
}
```
先录入如下数据，有三个字段title、price、description

| `_id` | title  | price | description |
| ----- | ------ | ----- | ----------- |
| 1     | 洗衣液  | 25    | 这个洗衣液很搞笑      |
| 2     | 手机   | 1999  | 很好用      |
| 3      |小老鼠        |0       |很好吃             |
倒排索引的示意如下，这就是es的查询效率高的原因
title字段不分词，整块匹配
description字段分词，每个字都是一个匹配

| 索引区     | 元数据区           |
| ---------- | ------------------ |
| 洗衣液 1   | 1 洗衣液 25 很搞笑 |
| 25 1       | ...                |
| 很 [1,2,3] |                    |
| 搞 1       |                    |
| 笑 1       |                    |
| 手机 2     |                    |
| 1999 2     |                    |
| 好 2       |                    |
| 用  2      |                    |
| ...        |                    |

注意:Elasticsearch分别为每个字段都建立了一个倒排索引。因此查询时查询字段的term.就能知道文档ID，就能快速找到文档。
每个索引还建立了在元数据区出现的次数，出现的位置等信息，用于计算分数，按照特定顺序输出
## 倒排索引的基本流程
倒排索引（Inverted Index）是信息检索中常用的数据结构，用于快速定位包含特定词项（term）的文档。它的基本原理是将文档集合中每个词项映射到包含该词项的文档列表上。

但是具体的细节都被忽视了，就像是打开冰箱，把大象装进去，关上冰箱

以下是倒排索引的基本实现流程：

1. **文档预处理**：
    
    - 将文档集合进行预处理，包括分词、去停用词、词干提取等操作，将每个文档转换成一组词项。
2. **构建倒排索引**：
    
    - 遍历每个文档的词项，对于每个词项，将其映射到包含该词项的文档列表上。
    - 对于每个词项，创建一个索引项（Posting），包含词项本身和包含该词项的文档列表。
    - 通常，可以使用哈希表（HashMap）或者树形结构来实现倒排索引。哈希表适用于存储稀疏的倒排索引，而树形结构（如红黑树或B树）适用于存储密集的倒排索引。
3. **查询处理**：
    
    - 当需要查询包含特定词项的文档时，检索该词项在倒排索引中对应的文档列表即可。
    - 如果查询包含多个词项，可以先检索每个词项的文档列表，然后对文档列表进行交集、并集等操作，得到最终的检索结果。
4. **优化**：
    
    - 对倒排索引进行压缩和优化，以减少内存占用和提高检索速度。常见的优化方法包括前缀压缩、差分编码、倒排列表的合并和分块存储等。
5. **更新**：
    
    - 当文档集合发生变化时（如添加、删除、更新文档），需要相应地更新倒排索引。

倒排索引是搜索引擎等信息检索系统的核心组件之一，它的设计和实现直接影响着系统的检索效率和性能。因此，在实际应用中，需要根据具体的需求和场景对倒排索引进行灵活的设计和优化。