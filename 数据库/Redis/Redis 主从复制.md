主从复制共有三种模式：**全量复制**、**基于长连接的命令传播**、**增量复制**。  

主从服务器第一次同步的时候，**就是采用全量复制，此时主服务器会两个耗时的地方，分别是生成 RDB 文件和传输 RDB 文件**。为了避免过多的从服务器和主服务器进行全量复制，可以把一部分从服务器升级为「经理角色」，让它也有自己的从服务器，通过这样可以分摊主服务器的压力。  

第一次同步完成后，**主从服务器都会维护着一个长连接，主服务器在接收到写操作命令后，就会通过这个连接将写命令传播给从服务器，来保证主从服务器的数据一致性**。  

如果遇到**网络断开**，增量复制就可以上场了，不过这个还跟 repl_backlog_size 这个大小有关系。 

如果它配置的过小，主从服务器网络恢复时，可能发生「从服务器」想读的数据已经被覆盖了，那么这时就会导致主服务器采用全量复制的方式。所以为了避免这种情况的频繁发生，要调大这个参数的值，以降低主从服务器断开后全量同步的概率。

**复制缓冲区**（replication buffer）主要用于全量同步完成后的写操作记录，确保从节点在加载完 RDB 文件后能够获取到完整的更新数据。**复制积压缓冲区**（replication backlog buffer）用于增量同步，它保存了最近的写操作命令，以便在从节点重新连接后能够快速获取到丢失的数据。